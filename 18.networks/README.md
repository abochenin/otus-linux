## Домашнее задание 18.networks

разворачиваем сетевую лабораторию

# Дано
https://github.com/erlong15/otus-linux/tree/network
(ветка network)

Vagrantfile с начальным построением сети
- inetRouter
- centralRouter
- centralServer

тестировалось на virtualbox

# Планируемая архитектура
построить следующую архитектуру

Сеть office1
- 192.168.2.0/26 - dev
- 192.168.2.64/26 - test servers
- 192.168.2.128/26 - managers
- 192.168.2.192/26 - office hardware

Сеть office2
- 192.168.1.0/25 - dev
- 192.168.1.128/26 - test servers
- 192.168.1.192/26 - office hardware


Сеть central
- 192.168.0.0/28 - directors
- 192.168.0.32/28 - office hardware
- 192.168.0.64/26 - wifi

```
Office1 ---\
            -----> Central --IRouter --> internet
Office2----/
```
Итого должны получится следующие сервера
- inetRouter
- centralRouter
- office1Router
- office2Router
- centralServer
- office1Server
- office2Server

# Теоретическая часть
- Найти свободные подсети
- Посчитать сколько узлов в каждой подсети, включая свободные
- Указать broadcast адрес для каждой подсети
- проверить нет ли ошибок при разбиении

# Практическая часть
- Соединить офисы в сеть согласно схеме и настроить роутинг
- Все сервера и роутеры должны ходить в инет черз inetRouter
- Все сервера должны видеть друг друга
- у всех новых серверов отключить дефолт на нат (eth0), который вагрант поднимает для связи
- при нехватке сетевых интервейсов добавить по несколько адресов на интерфейс

---


## Подготовка
Создаем виртуалки, набираемся терпения. Создаются не быстро...
```bash
vagrant up
```
## Проверки

Проверяем выход в интернет

```bash
$ vagrant ssh office1Server
[vagrant@office1Server ~]$ sudo su -
[root@office1Server ~]#

[root@office1Server ~]# ping -c 1 8.8.8.8
PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.
64 bytes from 8.8.8.8: icmp_seq=1 ttl=57 time=47.6 ms

--- 8.8.8.8 ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 47.618/47.618/47.618/0.000 ms

[root@office1Server ~]# tracepath -n 8.8.8.8
 1?: [LOCALHOST]                                         pmtu 1500
 1:  192.168.2.65                                          0.615ms
 1:  192.168.2.65                                          0.506ms
 2:  192.168.255.5                                         0.758ms
 3:  192.168.255.1                                         1.269ms
 4:  no reply
```

Проверяем доступность сервера из другого сегмента:

```bash
[root@office1Server ~]# tracepath -n 192.168.1.130
 1?: [LOCALHOST]                                         pmtu 1500
 1:  192.168.2.65                                          0.588ms
 1:  192.168.2.65                                          0.590ms
 2:  192.168.255.5                                         0.903ms
 3:  192.168.255.10                                        1.133ms
 4:  192.168.1.130                                         1.531ms reached
```

## Ответы на вопросы ДЗ


Свободные подсети:
192.158.0.16/28
192.168.0.48/28
192.168.0.128/25

      Подсеть    | Broadcast         
-----------------|----------------
192.168.0.0/28   | 192.168.0.15 
192.168.0.32/28  | 192.168.0.47 
192.168.0.64/26  | 192.168.0.127 
192.168.1.0/25   | 192.168.1.127 
192.168.1.128/26 | 192.168.1.191 
192.168.1.192/26 | 192.168.1.255 
192.168.2.0/26   | 192.168.2.63 
192.168.2.64/26  | 192.168.2.127 
192.168.2.128/26 | 192.168.2.191 
192.168.2.192/26 | 192.168.2.255 

Максимальное количество хостов в сетях:
        /25 - 126
        /26 - 62
        /27 - 30
        /28 - 14
        /29 - 6
        /30 - 2
Если учесть, что один адрес в сети обычно занят под шлюз, полезных адресов, соответственно, чуть меньше.

## Схема сети
```bash
office1server
eth1=192.168.2.66/26 ---+
                        |  office1router
                        |  eth1=192.168.2.1/26   o1-dev
                        +--eth2=192.168.2.65/26  o1-test-servers
                           eth3=192.168.2.129/26 o1-managers
                           eth4=192.168.2.193/26 o1-office-hardware
                           eth5=192.168.255.6/30 router-net    --------+
                                                                       |                                                 inetRouter
                                                                       |   central-router                                eth0=WAN uplink (nat)
                                                                       |   eth1=192.168.255.2/30  router-net ------------eth1=192.168.255.1/30
                                                                       +------- 192.168.255.5/30
CENTRAL-SERVER                                                         +------- 192.168.255.9/30
eth1=192.168.0.2/28 dir-net -------------------------------------------|-- eth2=192.168.0.1/28    dir-net
eth2=auto                                                              |   eth3=192.168.0.33/28   hw-net
eth3=auto                                                              |   eth4=192.168.0.65/26   mgt-net
                                                                       |
                                                                       |
                           office2router                               |
office2server              eth1=192.168.1.1/25    o2-dev               |
eth1=192.168.1.130/26------eth2=192.168.1.129/26  o2-test-servers      |
                           eth3=192.168.1.193/26  o2-ofice-hardware    |
                           eth4=192.168.255.10/30 router-net    -------+
```
